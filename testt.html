<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  <div>
    <button id="my-start-button">START</button>
    <button id="my-stop-button">STOP</button>
  </div>
  <script>
    import getUserMedia from 'get-user-media-promise';
    import MicrophoneStream from 'microphone-stream';

    document.getElementById('my-start-button').onclick = function () {
      console.log('my-start-button');
      // Note: in most browsers, this constructor must be called in response to a click/tap,
      // or else the AudioContext will remain suspended and will not provide any audio data.
      const micStream = new MicrophoneStream();

      getUserMedia({ video: false, audio: true })
        .then(function (stream) {
          micStream.setStream(stream);
        })
        .catch(function (error) {
          console.log(error);
        });

      // get Buffers (Essentially a Uint8Array DataView of the same Float32 values)
      micStream.on('data', function (chunk) {
        // Optionally convert the Buffer back into a Float32Array
        // (This actually just creates a new DataView - the underlying audio data is not copied or modified.)
        const raw = MicrophoneStream.toRaw(chunk);
        //...

        // note: if you set options.objectMode=true, the `data` event will output AudioBuffers instead of Buffers
      });

      // or pipe it to another stream
      micStream.pipe(/*...*/);

      // Access the internal audioInput for connecting to another nodes
      micStream.audioInput.connect(/*...*/);

      // It also emits a format event with various details (frequency, channels, etc)
      micStream.on('format', function (format) {
        console.log(format);
      });

      // Stop when ready
      document.getElementById('my-stop-button').onclick = function () {
        console.log('my-stop-button');
        micStream.stop();
      };
    };
  </script>
</body>
</html>